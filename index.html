<!doctype html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0,user-scalable=0" />
		<title>MongoDB_Log</title>
		<style>
			.class___line_head {
				margin-left : 2em;
			}
			.class___command {
				background-color : black;
				color : yellow;
				padding : 10px;
			}
			.class___code {
				color : yellow;
				background-color : black;
				line-height : 24px;
				font-size : 18px;
				vertical-align : bottom;
				white-space : nowrap;
				overflow-x : auto;
			}
			.class___tab {
				display : inline-block;
				width : 4ex;
				overflow-x : hidden;
				line-height : 24px;
				font-size : 18px;
				vertical-align : bottom;
				white-space : pre-wrap;
			}
		</style>
		<script>
		</script>
	</head>
	<body>
		<article>
			<header>
				
			</header>
			<section>
				<h2>mongodb web address</h2>
				<div>
					<a target="_blank" href="https://docs.mongodb.com/manual/">The MongoDB Manual — MongoDB Manual</a>
					<br/>
					<a target="_blank" href="https://docs.mongodb.com/drivers/">MongoDB Drivers and Ecosystem — MongoDB Drivers</a>
					<br/>
					<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/query/">Query and Projection Operators — MongoDB Manual</a>
					<br/>
					<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/query/text/index.html">$text — MongoDB Manual</a>
					<br/>
					<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/query/elemMatch/#op._S_elemMatch">$elemMatch (query) — MongoDB Manual</a>
					<br/>
					<a target="_blank" href="https://blog.csdn.net/rocky1996/article/details/75729727">MongoDB数据库的文件备份恢复以及文件导入导出_rocky1996的博客-CSDN博客_mongodb 文件备份</a>
					<br/>
					<a target="_blank" href="https://blog.csdn.net/ws1296931325/article/details/86626975">MongoDB的数据库文件_ws1296931325的博客-CSDN博客_mongodb 数据库文件</a>
					<br/>
					<a target="_blank" href="https://blog.csdn.net/sinat_32366329/article/details/82535170">MongoDB之文本搜索_一叶知春秋-CSDN博客_mongodb 搜索</a>
					<br/>
					<a target="_blank" href="https://blog.csdn.net/yaomingyang/article/details/78774968">Mongodb字段更新$max操作符_明洋的专栏-CSDN博客_mongodb $max</a>
					<br/>
					<a target="_blank" href="https://www.cnblogs.com/shengdimaya/p/6813254.html">mongodb使用mongos链接复制集 - M哥 - 博客园</a>
					<br/>
					<a target="_blank" href="https://blog.csdn.net/tengxy_cloud/article/details/53066971">Mongos与集群均衡_tengxy_cloud的专栏-CSDN博客</a>
					<br/>
					<a target="_blank" href="https://www.cnblogs.com/sunguangran/p/3805546.html">NoSQL 数据建模技术（转） - 可乐v加冰 - 博客园</a>
				</div>
			</section>
			<section>
				<h2>install mongodb node.js driver</h2>
				<p class="class___command">
					npm install mongodb --save
				</p>
			</section>
			<section>
				<h2>配置文格式</h2>
				<div>
					mongod configuration file can't use tab, need use space instead
					<br/>
					object's sub property must use space on head for example:
					<div class="class___code">
						storage&nbsp;:&nbsp;{<br/>
						<span class="class___tab">&#9;</span>dbPath&nbsp;:&nbsp;/home/share/mongodb_database/db<br/>
						}<br/>
					</div>
					follow code is error:
					<div class="class___code">
						storage&nbsp;:<br/>
						dbPath&nbsp;:&nbsp;/home/share/mongodb_database/db<br/>
					</div>
					follow code is correct:
					<div class="class___code">
						storage&nbsp;:<br/>
						<span style="">&nbsp;&nbsp;&nbsp;&nbsp;</span>dbPath&nbsp;:&nbsp;/home/share/mongodb_database/db<br/>
					</div>
				</div>
			</section>
			<section>
				<h2>start mongodb server</h2>
				<p>
					see the
					<a target="_blank" href="https://docs.mongodb.com/manual/reference/program/mongod/">Reference > MongoDB Package Components > mongod</a><br/>
					<span class="class___line_head"></span>--config &lt;filename&gt;, -f &lt;filename&gt;<br/>
					<span class="class___line_head"></span><span class="class___line_head"></span>Specifies a configuration file for runtime configuration options. The configuration file is the preferred method for runtime configuration of mongod. The options are equivalent to the command-line configuration options. See Configuration File Options for more information.
				</p>
				<p class="class___command">
					mongod --config &lt;filename&gt;
				</p>
				or
				<p class="class___command">
					mongod -f &lt;filename&gt;
				</p>
			</section>
			<section>
				<h2>查看当前数据库名称</h2>
				<p class="class___command">
					db
				</p>
				or
				<p class="class___command">
					db.getName();
				</p>
				output :
				<p class="class___command">
					test
				</p>
			</section>
			<section>
				<h2>数据库相关帮助</h2>
				<p class="class___command">
					db.help();
				</p>
			</section>
			<section>
				<h2>查看所有数据库</h2>
				<p class="class___command">
					show dbs
				</p>
				output :
				<p class="class___command">
					admin   0.000GB<br/>
					config  0.000GB<br/>
					local   0.000GB
				</p>
			</section>
			<section>
				<h2>切换或创建数据库</h2>
				当制定名称的数据库不存在时便自动创建
				<p class="class___command">
					use shell_test
				</p>
				output :
				<p class="class___command">
					switched to db shell_test
				</p>
			</section>
			<section>
				<h2>删除数据库</h2>
				<p class="class___command">
					use dbname;
					<br/>
					db.dropDatabase();
				</p>
				先选择使用要删除的数据库, 在删除当前数据库
			</section>
			<section>
				<h2>查看当前数据库的统计信息</h2>
				<p class="class___command">
					db.stats();
				</p>
				output :
				<p class="class___command">
					{<br/>
					<span class="class___line_head"></span>"db" : "test",<br/>
					<span class="class___line_head"></span>"collections" : 0,<br/>
					<span class="class___line_head"></span>"views" : 0,<br/>
					<span class="class___line_head"></span>"objects" : 0,<br/>
					<span class="class___line_head"></span>"avgObjSize" : 0,<br/>
					<span class="class___line_head"></span>"dataSize" : 0,<br/>
					<span class="class___line_head"></span>"storageSize" : 0,<br/>
					<span class="class___line_head"></span>"numExtents" : 0,<br/>
					<span class="class___line_head"></span>"indexes" : 0,<br/>
					<span class="class___line_head"></span>"indexSize" : 0,<br/>
					<span class="class___line_head"></span>"fileSize" : 0,<br/>
					<span class="class___line_head"></span>"fsUsedSize" : 0,<br/>
					<span class="class___line_head"></span>"fsTotalSize" : 0,<br/>
					<span class="class___line_head"></span>"ok" : 1<br/>
					}
				</p>
			</section>
			<section>
				<h2>查看数据库服务的版本</h2>
				<p class="class___command">
					db.version();
				</p>
				output :
				<p class="class___command">
					4.0.7
				</p>
			</section>
			<section>
				<h2>查看所有数据库服务的链接地址</h2>
				<p class="class___command">
					db.getMongo();
				</p>
				output :
				<p class="class___command">
					connection to 127.0.0.1:27017
				</p>
			</section>
			<section>
				<h2>查看当前数据库中的集合名称</h2>
				<p class="class___command">
					show collections;
				</p>
				or
				<p class="class___command">
					db.getCollectionNames();
				</p>
			</section>
			<section>
				<h2>使用集合</h2>
				<p class="class___command">
					db.getCollection("collection_name");
				</p>
				or
				<p class="class___command">
					db.collection_name
				</p>
				当集合名称为全数字时只能使用第1种形式, 第2种形式会报错
			</section>
			<section>
				<h2>查看当前集合中的文档数</h2>
				<p class="class___command">
					db.getCollection("collection_name").count;
				</p>
				or
				<p class="class___command">
					db.collection_name.count();
				</p>
			</section>
			<section>
				<h2>创建集合</h2>
				<p class="class___command">
					db.createCollection("collection_name", option);
				</p>
				or
				<p class="class___command">
					db.collection_name;
				</p>
				第2种形式为当存在便使用当不存在时便直接创建, 但当创建固定容量集合或创建名称为全数字的集合时只能使用第1种形式, 当不是创建固定容量集合时第1种形式中的option为可选项不用给出
			</section>
			<section>
				<h2>集合重命名</h2>
				<p class="class___command">
					db.getCollection("collection_name").renameCollection("collection_new_name");
				</p>
				or
				<p class="class___command">
					db.collection_name.renameCollection("collection_new_name");
				</p>
			</section>
			<section>
				<h2>删除集合</h2>
				<p class="class___command">
					db.getCollection("collection_name").drop();
				</p>
				or
				<p class="class___command">
					db.collection_name.drop();
				</p>
			</section>
			<section>
				<h2>新增文档</h2>
				<p class="class___command">
					db.&lt;collection_name&gt;.insertOne({name : 'Tom', age : '29', weight : 140});
				</p>
				一次新增一个(且只能是一个)文档对象
				<br/>
				or
				<p class="class___command">
					db.&lt;collection_name&gt;.insertMany([<br/>
						<span class="class___tab">&#9;</span>{name : 'Tom1', age : '29', weight : 140},<br/>
						<span class="class___tab">&#9;</span>{name : 'Tom2', age : '28', weight : 130},<br/>
						<span class="class___tab">&#9;</span>{name : 'Tom3', age : '27', weight : 120}<br/>
					]);
				</p>
				一次新增多个文档对象
				<br/>
				or
				<p class="class___command">
					db.&lt;collection_name&gt;.insert({name : 'Tom', age : '29', weight : 140});<br/>
					db.&lt;collection_name&gt;.insert([<br/>
						<span class="class___tab">&#9;</span>{name : 'Tom1', age : '29', weight : 140},<br/>
						<span class="class___tab">&#9;</span>{name : 'Tom2', age : '28', weight : 130},<br/>
						<span class="class___tab">&#9;</span>{name : 'Tom3', age : '27', weight : 120}<br/>
					]);
				</p>
				新增文档对象单个或多个均可
				<br/>
				or
				<p class="class___command">
					db.&lt;collection_name&gt;.save({name : 'Tom', age : '29', weight : 140});
				</p>
				如果给定的文档对象中未含有_id字段则save方法调用insert方法, 若含有_id则save方法到用upset方法并且指定参数option为true
				<br/>
				<br/>
				<br/>
				如果在新增文档时指定名称的集合不存在则将自动创建这个名称的集合然后执行新增文档操作
				<br/>
				新增操作的原子性在文档级别即只锁定到操作所涉及的文档对象
			</section>
			<section>
				<h2>查询文档</h2>
				<p class="class___command">
					db.&lt;collection_name&gt;.find({})
				</p>
				查询集合中的所有文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({name : "Tom1"})
				</p>
				查询集合中所有属性name为"Tom1"的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({<br/>
						<span class="class___tab">&#9;</span>age : {<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>$gt : 27<br/>
						<span class="class___tab">&#9;</span>}<br/>
					})
				</p>
				查询集合中所有属性age大于27的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({<br/>
						<span class="class___tab">&#9;</span>name : {<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>$in : ["Tom1", "Tom2"]<br/>
						<span class="class___tab">&#9;</span>}<br/>
					})</p>
				查询集合中所有属性name为"Tom1"或"Tom2"的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({
					<br/>
						<span class="class___tab">&#9;</span>$or : [<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>{name : "Tom1"},<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>{age : 28}<br/>
						<span class="class___tab">&#9;</span>]<br/>
					})
				</p>
				查询集合中所有属性name为"Tom1"或属性age为28的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({<br/>
						<span class="class___tab">&#9;</span>name : {
						<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>$in : ["Tom1", "Tom2"]
							<br/>
						<span class="class___tab">&#9;</span>}
						<br/>
					})
				</p>
				查询集合中所有属性name为"Tom1"或"Tom2"的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({<br/>
						<span class="class___tab">&#9;</span>size : {<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>h : 14,<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>w : 21,<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>uom : "cm",<br/>
						<span class="class___tab">&#9;</span>}<br/>
					})
				</p>
				查询集合中所有与size属性值完全相同(包括属性出现的前后顺序)的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({size.uom: : "in"})
				</p>
				查询集合中所有size属性的子属性uom的值为值"in"的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({<br/>
						<span class="class___tab">&#9;</span>tags : ["red", "black"]<br/>
					})
				</p>
				查询集合中所有与属性tags值完全相同的数组(包括元素的顺序)的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({<br/>
						<span class="class___tab">&#9;</span>tags : {<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>$all : ["red", "black"]<br/>
						<span class="class___tab">&#9;</span>}<br/>
					})
				</p>
				查询集合中所有与属性tags数组中同时含有"red"和"black"元素的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({tags : "red"})
				</p>
				查询集合中所有属性tags数组含有"red"元素的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({<br/>
						<span class="class___tab">&#9;</span>dim_cm : {<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>$gt : 25<br/>
						<span class="class___tab">&#9;</span>}<br/>
					})
				</p>
				查询集合中所有属性dim_cm数组中含有大于25的元素的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({<br/>
						<span class="class___tab">&#9;</span>dim_cm : {<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>$gt : 15,<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>$lt : 20<br/>
						<span class="class___tab">&#9;</span>}<br/>
					})
				</p>
				查询集合中所有属性dim_cm数组中含有大于15或小于20的元素的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({<br/>
						<span class="class___tab">&#9;</span>dim_cm : {<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>$elemMatch : {<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>$gt : 22,<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>$lt : 30<br/>
							<span class="class___tab">&#9;</span><span class="class___tab">&#9;</span>}<br/>
						<span class="class___tab">&#9;</span>}<br/>
					})
				</p>
				查询集合中所有属性dim_cm数组中含有大于22且小于30的元素的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({<br/>
						<span class="class___tab">&#9;</span>"dim_cm.1" : {$gt : 25}<br/>
					})
				</p>
				查询集合中所有属性dim_cm数组中索引为1的元素大于25的文档
				<p class="class___command">
					db.&lt;collection_name&gt;.find({<br/>
						<span class="class___tab">&#9;</span>tags : {$size : 3}<br/>
					})
				</p>
				查询集合中所有属性tags数组长度为3的文档
				<br/>
				<br/>
				<br/>
				查询返回一个集合并含有一个游标
			</section>
			<section>
				<h2>对字段的值模糊查询</h2>
				通过正则表达式进行模糊查询
				<br/>
				在shell中可以直接使用正则表达式
				<div class="class___command">
					db.user.find({name : /赵/});
				</div>
				查询所有在user集合中字段name含有'赵'字的所有记录
				<br/>
				但是在node.js中不能直接使用正则表达式, 需要使用$regex, 详细内容可参考:
				<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/query/regex/"/>Reference &gt; Operators &gt; Query and Projection Operators &gt; Evaluation Query Operators &gt; $regex</a>
				<br/>
				
				<div class="class___command">
					db.user.find({name : {$regex : '赵'}})
				</div>
			</section>
			<section>
				<h2>查询排序, 选择结果范围</h2>
				<div>
					举例查询score集合按mathematics字段升序排序, 前21至30条结果:
					<div class="class___command">
						db.score.find({}).sort({mathematics : 1}).skip(20).limit(10);
					</div>
					sort的参数为查询字段集合,字段的值为排序方式1为升序-1为降序, sort({mathematics : 1, physics : -1})表示先按mathematics字段升序排序再按physics字段降序排序
					<br/>
					skip(20)表示舍去前20条记录
					<br/>
					limit(10)表示返回10条记录
					<br/>
					若在node.js中sort({mathematics : 1, physics : -1})则为sort([[mathematics, 1], [physics, -1]])
				</div>
			</section>
		</article>
	</body>
</html>
